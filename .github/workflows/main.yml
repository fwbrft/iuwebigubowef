name: WARP Buy Bot

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # === 核心黑科技：启动 Cloudflare WARP ===
      # 这会将 GitHub 的 IP 变为 Cloudflare 的 IP，绕过封锁
      - name: Set up WARP
        uses: fscarmen/warp-on-actions@v1.1
        with:
          stack: dual # 启用双栈网络

      - name: Check IP (验证是否换IP成功)
        run: |
          echo "正在检查当前 IP..."
          curl -s https://ip.gs

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          pip install selenium

      - name: Run Script
        env:
          DOG_EMAIL: ${{ secrets.DOG_EMAIL }}
          DOG_PASSWORD: ${{ secrets.DOG_PASSWORD }}
        run: python main.py
